include(../lib/html/optinomic/page/start.m4)
<h3 class="md-headline">Datenexport: {{d.dataMain.apps.current.name}}</h3>
<div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="start stretch" layout-padding>
    <div flex>
        <md-select ng-model="d.export_obj.sql_field" ng-init="" aria-label="Abfragen">
            <md-option ng-repeat="item in d.export_obj.packages track by $index" value="{{item.sql}}">{{item.name}}</md-option>
        </md-select>
    </div>
    <md-button ng-if="d.export_obj.state !== 'edit'" style="font-size: 18px; color:#9E9E9E" ng-click="d.export_obj.state ='edit'" class="md-primary md-icon-button" aria-label="Close">
        <i class="mdi mdi-pencil"></i>
        <md-tooltip md-direction="bottom">
            Bearbeiten
        </md-tooltip>
    </md-button>
    <md-button ng-if="d.export_obj.state !== 'settings'" style="font-size: 18px; color:#9E9E9E" ng-click="d.export_obj.state ='settings'" class="md-primary md-icon-button" aria-label="Close">
        <i class="mdi mdi-dots-vertical"></i>
        <md-tooltip md-direction="bottom">
            Einstellungen
        </md-tooltip>
    </md-button>
</div>
<div ng-if="d.export_obj.state === 'settings'">
    <md-divider></md-divider>
    <div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="space-between center" layout-padding>
        <p class="md-subhead">Einstellungen</p>
        <md-button style="font-size: 18px; color:#9E9E9E" ng-click="d.export_obj.state ='start'" class="md-primary md-icon-button" aria-label="Close">
            <i class="mdi mdi-close"></i>
            <md-tooltip md-direction="bottom">
                Schliessen
            </md-tooltip>
        </md-button>
    </div>
    <div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="start stretch" layout-padding style="margin-top:-36px;">
        <div flex>
            <md-select ng-model="d.export_obj.format" ng-init="csv" aria-label="Format">
                <md-option value="csv">CSV</md-option>
                <md-option value="json">JSON</md-option>
            </md-select>
        </div>
        <div flex>
            <md-select ng-model="d.export_obj.direct" ng-init="True" aria-label="Typ">
                <md-option value="False">File-Download</md-option>
                <md-option value="True">Screen</md-option>
            </md-select>
        </div>
        <div flex ng-if="d.export_obj.format === 'csv'">
            <md-select ng-model="d.export_obj.header" ng-init="True" aria-label="Header">
                <md-option value="True">With header</md-option>
                <md-option value="False">No header</md-option>
            </md-select>
        </div>
        <div flex ng-if="d.export_obj.format === 'csv'">
            <md-select ng-model="d.export_obj.delimitter" ng-init=";" aria-label="Trennzeichen">
                <md-option value=";">Semicolon (;)</md-option>
                <md-option value=",">Comma (,)</md-option>
                <md-option value="|">Pipe (|)</md-option>
            </md-select>
        </div>
    </div>
</div>
<div ng-if="d.export_obj.state === 'edit'">
    <md-divider></md-divider>
    <div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="space-between center" layout-padding>
        <p class="md-subhead">Abfrage bearbeiten</p>
        <md-button style="font-size: 18px; color:#9E9E9E" ng-click="d.export_obj.state ='start'" class="md-primary md-icon-button" aria-label="Close">
            <i class="mdi mdi-close"></i>
            <md-tooltip md-direction="bottom">
                Schliessen
            </md-tooltip>
        </md-button>
    </div>
    <div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="space-between center" layout-padding style="margin-top:-36px;">
        <md-input-container flex class="md-block">
            <label>Abfrage (SQL)</label>
            <textarea ng-model="d.export_obj.sql_field" columns="1000"></textarea>
        </md-input-container>
    </div>
</div>
<div>
    <md-divider></md-divider>
    <md-button ng-click="d.functions.doExport()" class="md-primary" aria-label="Export">
        Jetzt ausf√ºhren
    </md-button>
</div>
<div ng-if="d.export_obj.have_data">
    <div ng-if="d.export_obj.direct === 'True'">
        <div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="space-between center" layout-padding>
            <p class="md-subhead">Daten</p>
            <md-button style="font-size: 18px; color:#9E9E9E" ng-click="d.export_obj.state ='start'" class="md-primary md-icon-button" aria-label="Close">
                <i class="mdi mdi-close"></i>
                <md-tooltip md-direction="bottom">
                    Schliessen
                </md-tooltip>
            </md-button>
        </div>
        <div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="space-between center" layout-padding>
            <pre>{{d.export_obj.data}}</pre>
        </div>
    </div>
    <div ng-if="d.export_obj.direct === 'False'">
        <div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="space-between center" layout-padding>
            <p class="md-subhead">Download File</p>
            <md-button style="font-size: 18px; color:#9E9E9E" ng-click="d.export_obj.state ='start'" class="md-primary md-icon-button" aria-label="Close">
                <i class="mdi mdi-close"></i>
                <md-tooltip md-direction="bottom">
                    Schliessen
                </md-tooltip>
            </md-button>
        </div>
        <div layout="row" layout-gt-xs="row" layout-xs="column" layout-align="space-between center" layout-padding>
            <md-button class="md-raised md-accent" ng-href="{{d.export_obj.data.download_url}}" target="_blank">Download</md-button>
        </div>
    </div>
</div>
include(../lib/html/optinomic/page/end.m4)
