<!--
@license
Copyright (c) 2018 Optionmic GmbH. All rights reserved.
-->
include(../lib/polymer2/optinomic-app-includes.m4)

<dom-module id="optinomic-app">
  <template>
    <style include="optinomic-styles">
      :host {
        display: block;
      }

    </style>

    <template is="dom-if" if="[[_loading]]">
      <paper-progress value="90" indeterminate bottom-item></paper-progress>
    </template>

    <optinomic-template name="template"></optinomic-template>
    <template is="dom-if" if="[[_isAdmin]]">
      <div style="margin-top: 64px;margin-bottom: 24px;">
        <paper-icon-button class="pink" on-tap="_logState" icon="bug-report"></paper-icon-button>
        <paper-icon-button class="indigo" on-tap="_loadData" icon="refresh"></paper-icon-button>
      </div>
    </template>

  </template>
  <script>
    /**
     * @customElement
     * @polymer
     */
    class optinomicApp extends Polymer.Element {
      static get is() {
        return 'optinomic-app';
      }

      static get properties() {
        return {};
      }

      _init() {

        var params = {
          "userID": parseInt(helpers.getUserID()),
          "patientID": parseInt(helpers.getPatientID()),
          "stayID": parseInt(helpers.getStayID()),
          "token": helpers.getToken(),
          "appName": helpers.getAppName(),
          "appID": helpers.getAppID(),
          "apiURL": helpers.getApiURL()
        };

        this.set('params', params);
        console.log('(✔) init', this.params);
        // this.dispatch('actionSaveParams', params);
      }

      _logState() {
        var state = this.getState();
        console.log('(✔) state', state);
      }

      _loadData() {
        Polymer.RenderStatus.afterNextRender(this, function () {
          console.warn('(START) _loadData');

          // loadData
          this.dispatch('actionGetCurrentUser');
          this.dispatch('actionGetApps');
          // this.dispatch('actionGetCurrentPatient'); this.dispatch('actionGetCurrentPatientStays');
          this.dispatch('actionGetClinic');

          this._logState();
        });
      }

      // Lifecycle
      ready() {
        super.ready();
        this._init();
        // this._logState();
      }
    }

    window.customElements.define(optinomicApp.is, optinomicApp);
  </script>
</dom-module>
