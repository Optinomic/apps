<link rel="import" href="polymer/polymer-element.html">
<link rel="import" href="paper-input/paper-input.html">
<link rel="import" href="vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="iron-dropdown/iron-dropdown.html">
<link rel="import" href="vaadin-valo-theme/vaadin-checkbox.html">
<link rel="import" href="vaadin-checkbox/vaadin-checkbox.html">

<dom-module id="export-filter">
  <template>
    <style include="optinomic-styles">
      :host {
        display: block;
      }

      .field {
        padding-right: 6px;
      }

      .filter_container {
        padding: 24px;
        background-color: #F5F5F5;
        border-radius: 24px;
        margin-bottom: 12px;
      }

    </style>

    <div id="element">
      <div class="filter_container">

        <div class="selector">
          <h3 >Erhebungszeitraum</h3>
          <vaadin-checkbox checked="{{_erhungszeitraum_use}}">
            <template is="dom-if" if="[[!_erhungszeitraum_use]]" restamp="true">nicht
            </template>einschränken
          </vaadin-checkbox>
        </div>

        <template is="dom-if" if="[[_erhungszeitraum_use]]" restamp="true">
          <div class="horizontal">
            <div class="field flex">
              <paper-input id="erhebungszeitraum_von" label="Von" placeholder="YYYY-MM-DD"></paper-input>
            </div>
            <div class="field flex">
              <paper-input id="erhebungszeitraum_bis" label="Bis" placeholder="YYYY-MM-DD"></paper-input>
            </div>
          </div>

          <vaadin-combo-box id="falltyp" style="width:100%" value="[[_d.falltyp.selected.typ]]" label="Falltyp" items="[[_d.falltyp.all]]" item-value-path="typ" item-label-path="typ">
            <template>
              <paper-icon-item>
                <paper-item-body two-line>
                  <div>
                    <b>[[item.typ]]:</b>
                    [[item.name]]</div>
                </paper-item-body>
              </paper-icon-item>
            </template>
          </vaadin-combo-box>
        </template>
      </div>
      <div class="filter_container">
        <div class="selector">
          <h3 >Patientengruppen</h3>
          <vaadin-checkbox checked="{{_patientgroups_use}}">
            <template is="dom-if" if="[[!_patientgroups_use]]" restamp="true">nicht
            </template>einschränken
          </vaadin-checkbox>
        </div>
        <template is="dom-if" if="[[_patientgroups_use]]" restamp="true">
          <p>Patient-Groups: [[_patient_groups.length]]</p>

          <p>[[_patient_groups.data[8].data.name]]</p>
        </template>

      </div>

      <div class="horizontal">
        <div class="flex">
          <paper-button class="grey" on-tap="_getFilter">Nicht anwenden</paper-button>
        </div>
        <div style="height:42px;">
          <paper-button class="pink" on-tap="_getFilter">Anwenden</paper-button>
        </div>
      </div>

    </div>

  </template>

  <script>

    class exportFilter extends Polymer.mixinBehaviors([opappBehavior], ReduxBehavior(Polymer.Element)) {

      static get is() {
        return 'export-filter';
      }

      static get properties() {
        return {

          _patient_groups: {
            type: Object,
            statePath: 'patient_groups.all'
          }

          _patient_groups_data: {
            type: Object,
            statePath: 'patient_groups.data'
          }

        };
      }

      _init() {

        var d = {};

        // Falltyp
        d.falltyp = {
          "all": [
            {
              "id": 0,
              "typ": "Alle",
              "name": "Alle Messungen im Erhebungszeitraum ausgeben"
            }, {
              "id": 1,
              "typ": "A1",
              "name": "Ein- und Austritt im Erhebungszeitraum"
            }, {
              "id": 2,
              "typ": "A2",
              "name": "Einritt vor Erhebungszeitraum und Austritt im Erhebungszeitraum"
            }, {
              "id": 3,
              "typ": "B",
              "name": "Einritt im Erhebungszeitraum und Austritt nach Erhebungszeitraum"
            }, {
              "id": 4,
              "typ": "C",
              "name": "Eintritt vor Erhebungszeitraum und Austritt nach Erhebungszeitraum"
            }
          ]
        };
        d.falltyp.selected = d.falltyp.all[0];

        // this._setDefaultFilter(); Set & Log
        d.init_done = true;
        this.set('_d', d);
        this._d = d;
        console.log('(INIT) <element-filter>', d);

        this.set('_erhungszeitraum_use', false);
        this.set('_patientgroups_use', false);

      }

      constructor() {
        super();
      }

      ready() {
        super.ready();

        Polymer.RenderStatus.afterNextRender(this, function () {
          this._init();
        });
      }

    }

    window.customElements.define(exportFilter.is, exportFilter);
  </script>
</dom-module>
