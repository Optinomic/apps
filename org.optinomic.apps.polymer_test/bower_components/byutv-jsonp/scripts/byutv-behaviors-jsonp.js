window.Byutv=window.Byutv||{},Byutv.behaviors=Byutv.behaviors||{},Byutv.behaviors.Jsonp={properties:{activeRequests:{type:Array,notify:!0,readOnly:!0,value:function(){this._setActiveRequests([])}},auto:{type:Boolean,value:!1},cache:{type:Boolean,value:!1},callbackKey:{type:String,value:"callback"},callbackValue:{type:String,value:function(){return"byutv_jsonp_callback_"+this._newGuid(!0)}},debounceDuration:{type:Number,value:0},lastAborted:{type:Boolean,notify:!0,readOnly:!0,reflectToAttribute:!0,value:!1},lastError:{type:Object,notify:!0,readOnly:!0},lastLoad:{type:Object,notify:!0,readOnly:!0},lastRequest:{type:Object,notify:!0,readOnly:!0},lastResponse:{type:Object,notify:!0,readOnly:!0},loading:{type:Boolean,notify:!0,readOnly:!0,reflectToAttribute:!0,value:!1},params:{type:Object,value:function(){return{}}},sync:{type:Boolean,value:!1},timeoutDuration:{type:Number,value:3e4},url:{type:String,value:""},verbose:{type:Boolean,value:!1}},factoryImpl:function(e){if(e&&"object"==typeof e){var t=this;Object.keys(e).forEach(function(s){t.setAttribute(s,e[s])})}},observers:["_requestOptionsChanged(auto, cache, callbackKey, callbackValue, debounceDuration, params, sync, timeoutDuration, url, verbose)"],get _queryString(){var e=this.params||{};return(void 0===this.callbackKey||this.callbackKey)&&(e[this.callbackKey]=this.callbackValue),this.cache||(e._=this._newGuid(!0)),Object.keys(e).reduce(function(t,s){return t.push(s+"="+encodeURIComponent(e[s]))&&t},[]).join("&")},get _requestUrl(){var e=this._queryString;return e?this.url+"?"+e:this.url},get _requestOptions(){return{cache:this.cache,callbackKey:this.callbackKey,callbackValue:this.callbackValue,sync:this.sync,url:this._requestUrl}},_requestOptionsChanged:function(){this.debounce("generate-request",function(){if(this.auto)try{this.generateRequest()}catch(e){}},this.debounceDuration)},generateRequest:function(){if(this.cache&&(/^byutv_jsonp_callback_[0-9a-f]{32}$/.test(this.callbackValue)||!this.callbackValue))throw new Error("`callback-value` must be declared or `callbackValue` set when `cache` is true.");if(!this.url)throw new Error("`url` must be declared or set in order to perform a request.");var e={};e.loading=!0,this._setLoading(!0),this._setLastAborted(!1),this._setLastRequest(e),this.activeRequests.push(e),e.options=this._requestOptions,e.script=document.createElement("script"),e.script.src=this._requestUrl,e.script.async=!this.sync;var t=this;return e.script.onload=function(s){t._handleLoad(e,s)},e.script.onerror=function(s){clearTimeout(e.timeout),t._handleError(e,s)},window[this.callbackValue]=function(s){clearTimeout(e.timeout),t._handleResponse(e,s)},document.querySelector("head").appendChild(e.script),e.timeout=setTimeout(function(){t._handleError(e,new ErrorEvent("error",{error:new Error("Timeout"),message:"The JSONP request timed out.",filename:"byutv-behaviors-jsonp.js"}))},this.timeoutDuration),this.fire("sent",e),e},abortRequest:function(e){!e&&this.activeRequests.length&&(e=this.activeRequests[this.activeRequests.length-1]),e&&this.activeRequests.indexOf(e)===this.activeRequests.length-1&&this._setLastAborted(!0),this._cleanupRequest(e)},_discardRequest:function(e){this._cleanupRequest(e),this.fire("complete",e)},_cleanupRequest:function(e){var t=this.activeRequests.indexOf(e);if(t>=0){this.activeRequests[t].loading=!1;var s=this.activeRequests.filter(function(e){return e.loading});s.length||this._setLoading(!1),this.activeRequests.splice(t,1),delete window[this.callbackValue],clearTimeout(e.timeout),e.script.parentNode.removeChild(e.script),e=null}},_handleResponse:function(e,t){this._setLastResponse(t),this._setLastError(void 0),this.fire("response",t),this._discardRequest(e)},_handleError:function(e,t){this.verbose&&console.error(t),this._setLastResponse(void 0),this._setLastError(t),this.fire("error",t),this._discardRequest(e)},_handleLoad:function(e,t){this._setLastLoad(t),this.fire("load",t)},_newGuid:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,s="x"===e?t:3&t|8;return s.toString(16)});return e?t.replace(/-/g,""):t}};